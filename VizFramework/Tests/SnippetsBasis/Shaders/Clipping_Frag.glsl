
vec4 srcFragment();
vec4 lightFragment(vec4 srcFragColor, float shadowFactor);


//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------

uniform int u_clipPlaneCount;

varying float v_clipDist[6];

#define CVF_CHECK_DISCARD_FRAGMENT_IMPL

//--------------------------------------------------------------------------------------------------
/// Check if fragment should be discarded based on clip distances and discard if needed
//--------------------------------------------------------------------------------------------------
void checkDiscardFragment()
{
	int i;
	for (i = 0; i < u_clipPlaneCount; i++)
	{
		if (v_clipDist[i] < 0) discard;
	}
}

//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------
//--------------------------------------------------------------------------------------------------


//--------------------------------------------------------------------------------------------------
/// Fragment Shader - Clipping plane experiment
//--------------------------------------------------------------------------------------------------
void main ()
{
#ifdef CVF_CHECK_DISCARD_FRAGMENT_IMPL
	checkDiscardFragment();
#endif

	vec4 color = srcFragment();
	color = lightFragment(color, 1.0);

	gl_FragColor = color;
}
